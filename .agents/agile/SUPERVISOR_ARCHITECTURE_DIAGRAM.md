# Supervisor Agent Architecture Diagram

```
┌──────────────────────────────────────────────────────────────────────────┐
│                        ARTEMIS ORCHESTRATOR                              │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                    SUPERVISOR AGENT                                │ │
│  │                  (Traffic Cop & Circuit Breaker)                   │ │
│  │                                                                    │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐            │ │
│  │  │   MONITOR    │  │    RETRY     │  │   CIRCUIT    │            │ │
│  │  │   HEALTH     │  │   LOGIC      │  │   BREAKER    │            │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘            │ │
│  │                                                                    │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐            │ │
│  │  │   TIMEOUT    │  │   PROCESS    │  │   ZOMBIE     │            │ │
│  │  │  DETECTION   │  │   CLEANUP    │  │   REAPER     │            │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘            │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                    PIPELINE STAGES                                 │ │
│  │                                                                    │ │
│  │  Stage 1          Stage 2          Stage 3          Stage 4       │ │
│  │  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐   │ │
│  │  │ Project  │ -> │ Architect│ -> │ Depend.  │ -> │  Devel.  │   │ │
│  │  │ Analysis │    │   ure    │    │ Valid.   │    │          │   │ │
│  │  └──────────┘    └──────────┘    └──────────┘    └──────────┘   │ │
│  │       ↓               ↓               ↓               ↓          │ │
│  │  [Supervised]    [Supervised]    [Supervised]    [Supervised]   │ │
│  │                                                                    │ │
│  │  Stage 5          Stage 6          Stage 7          Stage 8       │ │
│  │  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐   │ │
│  │  │   Code   │ -> │  Valid.  │ -> │  Integr. │ -> │ Testing  │   │ │
│  │  │  Review  │    │          │    │          │    │          │   │ │
│  │  └──────────┘    └──────────┘    └──────────┘    └──────────┘   │ │
│  │       ↓               ↓               ↓               ↓          │ │
│  │  [Supervised]    [Supervised]    [Supervised]    [Supervised]   │ │
│  └────────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## Supervision Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                      STAGE EXECUTION FLOW                           │
└─────────────────────────────────────────────────────────────────────┘

                         START STAGE
                              │
                              ↓
                   ┌──────────────────────┐
                   │  Check Circuit       │
                   │  Breaker Status      │
                   └──────────────────────┘
                              │
                 ┌────────────┴────────────┐
                 │                         │
           Circuit OPEN              Circuit CLOSED
                 │                         │
                 ↓                         ↓
        ┌─────────────────┐      ┌─────────────────┐
        │ Execute Fallback│      │  Execute Stage  │
        │  or Skip Stage  │      │  (with timeout) │
        └─────────────────┘      └─────────────────┘
                 │                         │
                 │                 ┌───────┴────────┐
                 │                 │                │
                 │            SUCCESS          FAILURE
                 │                 │                │
                 │                 ↓                ↓
                 │        ┌─────────────┐   ┌──────────────┐
                 │        │  Record     │   │ Retry Count  │
                 │        │  Success    │   │ < Max?       │
                 │        └─────────────┘   └──────────────┘
                 │                 │            │        │
                 │                 │          YES       NO
                 │                 │            │        │
                 │                 │            ↓        ↓
                 │                 │    ┌──────────┐ ┌──────────┐
                 │                 │    │  Wait    │ │ Circuit  │
                 │                 │    │ Backoff  │ │ Breaker? │
                 │                 │    └──────────┘ └──────────┘
                 │                 │            │        │
                 │                 │            └────┐   │
                 │                 │                 │   ↓
                 │                 │        ┌────────┴─────────┐
                 │                 │        │ Check Threshold  │
                 │                 │        └──────────────────┘
                 │                 │           │           │
                 │                 │      Below      Above
                 │                 │           │           │
                 │                 │           ↓           ↓
                 │                 │     ┌─────────┐  ┌─────────┐
                 │                 │     │  Retry  │  │  Open   │
                 │                 │     │  Stage  │  │ Circuit │
                 │                 │     └─────────┘  └─────────┘
                 │                 │           │           │
                 └─────────────────┴───────────┴───────────┘
                                   │
                                   ↓
                            STAGE COMPLETE
```

---

## Component Interactions

```
┌───────────────────────────────────────────────────────────────┐
│                     SUPERVISOR INTERACTIONS                   │
└───────────────────────────────────────────────────────────────┘

    ┌──────────────┐
    │ Orchestrator │
    └──────┬───────┘
           │
           │ 1. Register stages
           │ 2. Execute with supervision
           │
           ↓
    ┌──────────────┐
    │  Supervisor  │◄────────────────┐
    └──────┬───────┘                 │
           │                         │
           │ 3. Monitor execution    │ 7. Report health
           │                         │
           ↓                         │
    ┌──────────────┐                 │
    │ Stage Worker │                 │
    └──────┬───────┘                 │
           │                         │
     ┌─────┴──────┐                  │
     │            │                  │
  SUCCESS      FAILURE                │
     │            │                  │
     │            ↓                  │
     │     ┌──────────────┐          │
     │     │ Retry Logic  │          │
     │     └──────┬───────┘          │
     │            │                  │
     │     ┌──────┴──────┐           │
     │     │             │           │
     │  Recover      Max Retries     │
     │     │         Exceeded        │
     │     │             │           │
     │     ↓             ↓           │
     │  ┌─────┐    ┌──────────┐     │
     │  │ OK  │    │ Circuit  │     │
     │  └──┬──┘    │ Breaker  │     │
     │     │       └────┬─────┘     │
     │     │            │           │
     └─────┴────────────┴───────────┘
           │
           ↓
    ┌──────────────┐
    │   Results    │
    └──────────────┘
```

---

## Recovery Strategy Decision Tree

```
                    STAGE FAILS
                         │
                         ↓
              ┌──────────────────────┐
              │  Circuit Breaker     │
              │  Already Open?       │
              └──────────────────────┘
                    │         │
                   YES        NO
                    │         │
                    ↓         ↓
          ┌──────────────┐   ┌──────────────┐
          │ Skip Stage   │   │ Check Retry  │
          │ (or Fallback)│   │ Count        │
          └──────────────┘   └──────────────┘
                    │              │
                    │         ┌────┴────┐
                    │         │         │
                    │    Count < Max   Count >= Max
                    │         │         │
                    │         ↓         ↓
                    │   ┌──────────┐ ┌──────────────┐
                    │   │  Wait    │ │ Check Circuit│
                    │   │ Backoff  │ │ Threshold    │
                    │   └──────────┘ └──────────────┘
                    │         │         │
                    │         ↓    ┌────┴────┐
                    │   ┌──────────┐│         │
                    │   │  Retry   ││  Below  Above
                    │   │  Stage   ││         │
                    │   └──────────┘│         ↓
                    │         │     │   ┌──────────┐
                    │         │     │   │   Open   │
                    │         │     │   │  Circuit │
                    │         │     │   └──────────┘
                    │         │     │         │
                    └─────────┴─────┴─────────┘
                              │
                              ↓
                        CONTINUE
```

---

## Health Monitoring System

```
┌─────────────────────────────────────────────────────────────┐
│                    HEALTH MONITORING                        │
└─────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────┐
    │         SUPERVISOR MONITORS             │
    └─────────────────────────────────────────┘
                      │
         ┌────────────┼────────────┐
         │            │            │
         ↓            ↓            ↓
    ┌────────┐  ┌────────┐  ┌────────┐
    │ Stage  │  │Process │  │Circuit │
    │ Exec.  │  │ Health │  │Breaker │
    │ Time   │  │ Status │  │ State  │
    └────────┘  └────────┘  └────────┘
         │            │            │
         └────────────┼────────────┘
                      ↓
         ┌─────────────────────────┐
         │   HEALTH AGGREGATION    │
         └─────────────────────────┘
                      │
         ┌────────────┼────────────┐
         │            │            │
         ↓            ↓            ↓
    ┌────────┐  ┌────────┐  ┌────────┐
    │HEALTHY │  │DEGRADED│  │FAILING │
    │  ✅    │  │  ⚠️     │  │  ❌    │
    └────────┘  └────────┘  └────────┘
                                │
                                ↓
                          ┌────────┐
                          │CRITICAL│
                          │  🚨    │
                          └────────┘

    HEALTH CRITERIA:
    ┌──────────────────────────────────────┐
    │ HEALTHY:   No failures (last 5 min)  │
    │ DEGRADED:  1-2 failures (last 5 min) │
    │ FAILING:   3+ failures (last 5 min)  │
    │ CRITICAL:  Circuit breakers open     │
    └──────────────────────────────────────┘
```

---

## Process Lifecycle Management

```
┌─────────────────────────────────────────────────────────────┐
│              PROCESS LIFECYCLE MANAGEMENT                   │
└─────────────────────────────────────────────────────────────┘

    STAGE STARTS
         │
         ↓
    ┌─────────────┐
    │  Register   │
    │  Process    │
    └─────────────┘
         │
         ↓
    ┌─────────────┐
    │   Monitor   │◄───┐
    │  (every 5s) │    │
    └─────────────┘    │
         │             │
    ┌────┴────┐        │
    │         │        │
   OK      ISSUE       │
    │         │        │
    │    ┌────┴────┐   │
    │    │         │   │
    │  HANG    TIMEOUT │
    │    │         │   │
    │    ↓         ↓   │
    │  ┌─────────────┐ │
    │  │CPU > 90%    │ │
    │  │Time > 5min  │ │
    │  └─────────────┘ │
    │         │        │
    │         ↓        │
    │  ┌─────────────┐ │
    │  │  Kill       │ │
    │  │  Process    │ │
    │  │  (SIGTERM)  │ │
    │  └─────────────┘ │
    │         │        │
    │    ┌────┴────┐   │
    │    │         │   │
    │  Success   Timeout
    │    │         │   │
    │    │         ↓   │
    │    │  ┌─────────────┐
    │    │  │  Kill       │
    │    │  │  Process    │
    │    │  │  (SIGKILL)  │
    │    │  └─────────────┘
    │    │         │
    └────┴─────────┘
         │
         ↓
    ┌─────────────┐
    │  Cleanup    │
    │  Zombies    │
    └─────────────┘
         │
         ↓
    STAGE ENDS
```

---

## Integration Architecture

```
┌───────────────────────────────────────────────────────────────────┐
│                  ARTEMIS SYSTEM ARCHITECTURE                      │
│                    (WITH SUPERVISOR)                              │
└───────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                      USER / CLI                                 │
└─────────────────────────────────────────────────────────────────┘
                             │
                             ↓
┌─────────────────────────────────────────────────────────────────┐
│                 ARTEMIS ORCHESTRATOR                            │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │               SUPERVISOR AGENT                            │  │
│  │  [Monitor] [Retry] [Circuit Breaker] [Cleanup]           │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                             │
         ┌───────────────────┼───────────────────┐
         │                   │                   │
         ↓                   ↓                   ↓
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ KANBAN BOARD    │  │ AGENT MESSENGER │  │  RAG AGENT      │
│ (Task Queue)    │  │ (Notifications) │  │ (Learning)      │
└─────────────────┘  └─────────────────┘  └─────────────────┘
         │                   │                   │
         └───────────────────┼───────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────────────┐
│                    PIPELINE STAGES                              │
│  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐  │
│  │Stage1│→ │Stage2│→ │Stage3│→ │Stage4│→ │Stage5│→ │Stage6│  │
│  └──────┘  └──────┘  └──────┘  └──────┘  └──────┘  └──────┘  │
│     ↓          ↓          ↓          ↓          ↓          ↓   │
│  [Supervised] [Supervised] [Supervised] ... [Supervised]       │
└─────────────────────────────────────────────────────────────────┘
                             │
         ┌───────────────────┼───────────────────┐
         ↓                   ↓                   ↓
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ REDIS METRICS   │  │ CONFIG AGENT    │  │ LLM CLIENTS     │
│ (Analytics)     │  │ (Settings)      │  │ (OpenAI/Claude) │
└─────────────────┘  └─────────────────┘  └─────────────────┘
```

---

## Data Flow

```
┌───────────────────────────────────────────────────────────────┐
│                      DATA FLOW                                │
└───────────────────────────────────────────────────────────────┘

INPUT: Card from Kanban Board
   │
   ↓
┌──────────────────────────┐
│  Orchestrator Receives   │
│  Card ID                 │
└──────────────────────────┘
   │
   ↓
┌──────────────────────────┐
│  Create Workflow Plan    │
│  (Planner)               │
└──────────────────────────┘
   │
   ↓
┌──────────────────────────┐
│  Filter Stages by Plan   │
└──────────────────────────┘
   │
   ↓
FOR EACH STAGE:
   │
   ├─► ┌────────────────────────┐
   │   │  Supervisor Checks     │
   │   │  Circuit Breaker       │
   │   └────────────────────────┘
   │            │
   │       ┌────┴────┐
   │      OPEN    CLOSED
   │       │         │
   │   [Skip]       │
   │       │         ↓
   │       │   ┌────────────────────────┐
   │       │   │  Execute Stage         │
   │       │   │  (with timeout monitor)│
   │       │   └────────────────────────┘
   │       │         │
   │       │    ┌────┴────┐
   │       │  SUCCESS   FAILURE
   │       │    │         │
   │       │    │    ┌────┴────┐
   │       │    │    │  Retry  │
   │       │    │    │  Logic  │
   │       │    │    └────┬────┘
   │       │    │         │
   │       │    │    ┌────┴────┐
   │       │    │  Recover  Circuit
   │       │    │    │      Open
   │       │    │    │         │
   │       └────┴────┴─────────┘
   │                 │
   ↓                 ↓
   │   ┌────────────────────────┐
   │   │  Update Context        │
   │   │  (for next stage)      │
   │   └────────────────────────┘
   │                 │
   └─────────────────┘
            │
            ↓
┌──────────────────────────┐
│  Generate Report         │
│  (with supervisor stats) │
└──────────────────────────┘
            │
            ↓
┌──────────────────────────┐
│  Print Health Report     │
└──────────────────────────┘
            │
            ↓
OUTPUT: Pipeline Report + Health Statistics
```

---

## Statistics Tracking

```
┌───────────────────────────────────────────────────────────────┐
│               STATISTICS TRACKING SYSTEM                      │
└───────────────────────────────────────────────────────────────┘

    PER STAGE:
    ┌─────────────────────────────────────┐
    │ • Execution count                   │
    │ • Failure count                     │
    │ • Total duration                    │
    │ • Average duration                  │
    │ • Failure rate %                    │
    │ • Last failure timestamp            │
    │ • Circuit breaker state             │
    │ • Circuit open until (if open)      │
    └─────────────────────────────────────┘

    GLOBAL:
    ┌─────────────────────────────────────┐
    │ • Total interventions               │
    │ • Successful recoveries             │
    │ • Failed recoveries                 │
    │ • Processes killed                  │
    │ • Timeouts detected                 │
    │ • Hanging processes detected        │
    │ • Zombie processes cleaned          │
    │ • Overall health status             │
    └─────────────────────────────────────┘

    OUTPUT:
    ┌─────────────────────────────────────┐
    │ • Health report (terminal)          │
    │ • Pipeline report (JSON)            │
    │ • Redis metrics (optional)          │
    │ • Agent messenger alerts            │
    └─────────────────────────────────────┘
```

---

**Legend:**
- `→` Flow direction
- `↓` Sequential step
- `┌─┐` Component/box
- `◄─` Feedback loop
- `├─┤` Conditional branch
- `[X]` Action/state

**Version:** 1.0
**Status:** ✅ PRODUCTION READY
